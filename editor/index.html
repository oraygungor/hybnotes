<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HybNotes Live Studio</title>
    
    <!-- React & Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- KaTeX (Matematik) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        /* --- TEMEL AYARLAR --- */
        body { background-color: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* --- RICH TEXT CONTENT --- */
        .rich-text-content { font-family: 'Inter', sans-serif; line-height: 1.8; font-size: 16px; color: #cbd5e1; }
        .rich-text-content h1 { font-size: 2em; font-weight: 800; color: #fff; margin: 1em 0 0.5em; }
        .rich-text-content h2 { font-size: 1.5em; font-weight: 700; color: #e2e8f0; margin: 1.5em 0 0.5em; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        .rich-text-content h3 { font-size: 1.25em; font-weight: 600; color: #94a3b8; margin: 1.5em 0 0.5em; }
        .rich-text-content p { margin-bottom: 1em; }
        .rich-text-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .rich-text-content ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1rem; }
        
        .rich-text-content blockquote {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            color: #fbbf24;
            font-style: italic;
        }

        .math-box {
            display: block;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(6, 182, 212, 0.1);
            border-left: 4px solid #06b6d4;
            border-radius: 0 8px 8px 0;
            color: #22d3ee;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
        }

        /* --- QUILL EDİTÖR ÖZELLEŞTİRMESİ --- */
        .ql-toolbar.ql-snow { background: #1e293b; border-color: #334155 !important; border-radius: 12px 12px 0 0; }
        .ql-container.ql-snow { background: #0f172a; border-color: #334155 !important; border-radius: 0 0 12px 12px; color: #cbd5e1; font-family: 'Inter', sans-serif; font-size: 16px; }
        .ql-editor.ql-blank::before { color: #475569; font-style: italic; }
        
        .ql-editor h2 { font-size: 1.5em; font-weight: 700; color: #e2e8f0; margin-top: 1em; border-bottom: 1px solid #334155; }
        .ql-editor blockquote { border-left: 4px solid #f59e0b; background: rgba(245, 158, 11, 0.1); color: #fbbf24; font-style: italic; }
        .ql-editor .math-box { border-left: 4px solid #06b6d4; background: rgba(6, 182, 212, 0.1); color: #22d3ee; font-family: 'JetBrains Mono'; text-align: center; padding: 1rem; margin: 1rem 0; }

        /* Toolbar İkonları */
        .ql-snow .ql-stroke { stroke: #94a3b8 !important; }
        .ql-snow .ql-fill { fill: #94a3b8 !important; }
        .ql-snow .ql-picker { color: #94a3b8 !important; }
        .ql-snow .ql-picker-options { background-color: #1e293b !important; border-color: #334155 !important; }
        
        /* ÖZEL TOOLBAR BUTONU (MATHBOX) */
        .ql-mathbox {
            font-weight: bold;
            color: #22d3ee !important; /* Cyan renk */
            width: auto !important;
            padding: 0 5px !important;
            font-family: 'JetBrains Mono', monospace;
        }
        .ql-mathbox:hover {
            color: #fff !important;
        }
        .ql-mathbox::after {
            content: "[ MB ]"; /* Buton üzerinde görünecek metin */
            font-size: 12px;
        }

        /* Scrollbars */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const CATEGORIES = [
            { tr: "Antrenman Bilimi", en: "Training Science" },
            { tr: "Beslenme", en: "Nutrition" },
            { tr: "Fizyoloji", en: "Physiology" },
            { tr: "Sistem Kılavuzu", en: "System Guide" }
        ];

        const App = () => {
            // --- STATE ---
            const [title, setTitle] = useState("Örnek Makale Başlığı");
            const [summary, setSummary] = useState("Makalenin kısa özeti buraya gelecek...");
            const [categoryIndex, setCategoryIndex] = useState(0);
            const [references, setReferences] = useState([]);
            const [refInput, setRefInput] = useState("");
            const [readTime, setReadTime] = useState(5);
            const [editorHtml, setEditorHtml] = useState("");
            const [jsonOutput, setJsonOutput] = useState("");

            const quillRef = useRef(null);
            const previewRef = useRef(null);

            // --- 1. QUILL BAŞLATMA ---
            useEffect(() => {
                if (window.katex) window.katex = katex;

                if (!quillRef.current) {
                    const container = document.getElementById('editor-container');
                    
                    // Custom Blot
                    const Block = Quill.import('blots/block');
                    class MathBox extends Block {}
                    MathBox.blotName = 'math-box';
                    MathBox.tagName = 'div';
                    MathBox.className = 'math-box';
                    Quill.register(MathBox);

                    // Custom Toolbar Handler
                    const addMathBoxHandler = function() {
                        const range = this.quill.getSelection(true) || { index: this.quill.getLength() };
                        const html = `<div class="math-box">$$ x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a} $$</div><p><br></p>`;
                        this.quill.clipboard.dangerouslyPasteHTML(range.index, html);
                    };

                    const quill = new Quill(container, {
                        theme: 'snow',
                        modules: {
                            toolbar: {
                                container: [
                                    [{ 'header': [2, 3, false] }],
                                    ['bold', 'italic', 'underline', 'strike'],
                                    ['blockquote', 'code-block', 'mathbox'], // 'mathbox' butonu buraya eklendi
                                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                                    [{ 'script': 'sub'}, { 'script': 'super' }],
                                    [{ 'color': [] }, { 'background': [] }],
                                    ['link', 'formula', 'clean']
                                ],
                                handlers: {
                                    'mathbox': addMathBoxHandler
                                }
                            }
                        },
                        placeholder: 'İçerik yazmaya başla...'
                    });

                    quillRef.current = quill;

                    // Başlangıç İçeriği
                    const initialContent = `
                        <p>Toolbar'daki <strong>[ MB ]</strong> butonuna basarak aşağıdakini oluşturabilirsin:</p>
                        <div class="math-box">$$ E = mc^2 $$</div>
                        <p>Bu bir formül kutusudur.</p>
                        <blockquote>"Bu bir alıntıdır."</blockquote>
                    `;
                    quill.clipboard.dangerouslyPasteHTML(0, initialContent);

                    // Değişiklikleri Dinle
                    quill.on('text-change', () => {
                        const html = quill.root.innerHTML;
                        const text = quill.getText();
                        const wordCount = text.trim().split(/\s+/).length;
                        setReadTime(Math.max(1, Math.ceil(wordCount / 180)));
                        setEditorHtml(html);
                    });
                }
            }, []);

            // --- 2. CANLI GÜNCELLEME ---
            useEffect(() => {
                const cleanContent = editorHtml
                    .replace(/"/g, "'")
                    .replace(/<p><br><\/p>/g, "");

                const dataObj = {
                    id: Math.floor(Math.random() * 9999),
                    date: new Date().toISOString().split('T')[0],
                    readTime: { tr: `${readTime} dk`, en: `${readTime} min` },
                    category: CATEGORIES[categoryIndex],
                    title: { tr: title, en: title + " (EN)" },
                    summary: { tr: summary, en: summary + " (EN)" },
                    content: { tr: cleanContent, en: cleanContent },
                    references: references
                };

                setJsonOutput(JSON.stringify([dataObj], null, 2));

                if (previewRef.current && window.renderMathInElement) {
                    setTimeout(() => {
                        try {
                            window.renderMathInElement(previewRef.current, {
                                delimiters: [
                                    {left: '$$', right: '$$', display: true},
                                    {left: '$', right: '$', display: false}
                                ],
                                throwOnError: false
                            });
                        } catch (e) {}
                    }, 50);
                }

            }, [title, summary, categoryIndex, references, editorHtml]);

            // --- YARDIMCILAR ---
            const addReference = () => {
                if (refInput.trim()) {
                    setReferences([...references, refInput.trim()]);
                    setRefInput("");
                }
            };

            const copyJson = () => {
                navigator.clipboard.writeText(jsonOutput);
                alert("JSON Kopyalandı!");
            };

            return (
                <div className="flex h-screen w-full">
                    
                    {/* --- SOL PANEL: EDİTÖR --- */}
                    <div className="w-1/2 h-full flex flex-col border-r border-slate-800 bg-slate-900/50 p-6 overflow-y-auto custom-scrollbar">
                        <header className="mb-6 flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center font-black text-slate-900">HN</div>
                                <h1 className="text-xl font-bold text-white">Live Studio</h1>
                            </div>
                        </header>

                        <div className="space-y-4 mb-6">
                            <input type="text" value={title} onChange={e => setTitle(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-cyan-500 outline-none font-bold text-lg" placeholder="Başlık" />
                            <textarea value={summary} onChange={e => setSummary(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-sm text-slate-300 focus:border-cyan-500 outline-none resize-none h-20" placeholder="Özet" />
                            <div className="grid grid-cols-2 gap-4">
                                <select value={categoryIndex} onChange={e => setCategoryIndex(Number(e.target.value))} className="bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-sm text-white outline-none">
                                    {CATEGORIES.map((c, i) => <option key={i} value={i}>{c.tr}</option>)}
                                </select>
                                <div className="bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-sm text-center text-cyan-400 font-mono font-bold">{readTime} dk</div>
                            </div>
                        </div>

                        <div className="flex-grow flex flex-col min-h-[400px]">
                            <div id="editor-container" className="flex-grow rounded-b-xl"></div>
                        </div>

                        <div className="mt-6 pt-6 border-t border-slate-800">
                            <div className="flex gap-2 mb-2">
                                <input type="text" value={refInput} onChange={e => setRefInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && addReference()} className="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-xs text-white outline-none" placeholder="Kaynak ekle..." />
                                <button onClick={addReference} className="bg-slate-700 px-4 rounded-lg text-xs font-bold hover:bg-slate-600">EKLE</button>
                            </div>
                            <div className="flex flex-wrap gap-2">
                                {references.map((ref, i) => (
                                    <span key={i} className="text-[10px] bg-slate-800 text-slate-400 px-2 py-1 rounded border border-slate-700 cursor-pointer hover:text-red-400" onClick={() => {const n = [...references]; n.splice(i,1); setReferences(n);}}>{ref} ×</span>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* --- SAĞ PANEL: ÇIKTI --- */}
                    <div className="w-1/2 h-full flex flex-col bg-[#0f172a]">
                        <div className="h-[60%] border-b border-slate-800 p-8 overflow-y-auto custom-scrollbar relative">
                            <div className="absolute top-4 right-4 bg-black/50 text-slate-500 text-[10px] font-bold px-2 py-1 rounded uppercase">Canlı Önizleme</div>
                            <div ref={previewRef} className="rich-text-content max-w-2xl mx-auto">
                                <div className="flex gap-2 text-[10px] font-bold uppercase text-slate-500 mb-4 font-mono tracking-wider">
                                    <span className="text-cyan-500">{CATEGORIES[categoryIndex].tr}</span>
                                    <span>•</span>
                                    <span>{new Date().toISOString().split('T')[0]}</span>
                                </div>
                                <h1>{title}</h1>
                                <div dangerouslySetInnerHTML={{ __html: editorHtml }} />
                                {references.length > 0 && (
                                    <div className="mt-8 pt-6 border-t border-slate-800/50">
                                        <h5 className="text-[10px] font-black text-slate-500 uppercase mb-2">Referanslar</h5>
                                        <ul className="text-xs text-slate-500 space-y-1">
                                            {references.map((r, i) => <li key={i}>{r}</li>)}
                                        </ul>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="h-[40%] bg-[#0b1120] p-4 flex flex-col">
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Canlı JSON Çıktısı</h3>
                                <button onClick={copyJson} className="text-[10px] font-bold text-cyan-400 hover:text-white uppercase transition-colors">Kopyala</button>
                            </div>
                            <div className="flex-grow overflow-auto custom-scrollbar rounded-xl border border-slate-800 bg-[#020617] p-4">
                                <pre className="text-[11px] font-mono text-emerald-400 whitespace-pre-wrap leading-relaxed">{jsonOutput}</pre>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
